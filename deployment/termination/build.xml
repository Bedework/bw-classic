<?xml version="1.0"?>

<!-- ===================================================================
     terminations task.
     =================================================================== -->

<project name="bwdeploy.termination" default="deploy" >
  <import file="${org.bedework.deployment.base}/deployprops.xml" />

  <import file="${build.dir}/platforms/${org.bedework.global.deploy.platform}.xml" />

  <dirname property="this.dir" file="${ant.file}"/>

  <target name="init">
  </target>

  <target name="deploy" depends="init,build.configured" >
    <!-- copy startup website that sends you to the applications -->
    <property name="startup.website.dir"
              location="${org.bedework.appserver.dir}/${org.bedework.server.resource.root.dir}/bedework" />
    <delete dir="${startup.website.dir}"/>
    <mkdir dir="${startup.website.dir}"/>
    <copy todir="${startup.website.dir}">
      <fileset dir="${app.root.dir}/resources/bedework"/>
    </copy>

    <!-- copy any jars required in the server lib (jdbc etc) -->
    <if>
      <available file="${org.bedework.global.ext.lib}/server" type="dir" />
      <then>
        <copy todir="${appserver.lib.dir}" flatten="yes" >
          <fileset dir="${org.bedework.global.ext.lib}/server">
            <include name="*.jar"/>
          </fileset>
        </copy>
      </then>
    </if>
    
    <if>
      <isset property="org.bedework.global.extra.jars" />
      <then>
        <foreach list="${org.bedework.global.extra.jars}"
                 target="copyToServer"
                 param="org.bedework.extra.jar"
                 inheritall="true"
                 trim="true" />
      </then>
    </if>

    <if>
      <available file="${java.tools.jar}" />
      <then>
        <copy todir="${appserver.lib.dir}" file="${java.tools.jar}"/>
      </then>
    </if>
  	
    <!-- Platform specific -->
    <antcall target="doPlatform" inheritRefs="true" />
  </target>

  <target name="build.configured" depends="init" >
  </target>
  
  <target name="copyToServer">
    <copy todir="${appserver.lib.dir}" file="${org.bedework.extra.jar}" />
  </target>
</project>
