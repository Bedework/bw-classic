<!--
     This is the build.xml for bedework which is called by the main build
     file to create a ear file.

     Properties which must be defined on entry, apart from those described
     in the main build file are:
       app.name          Directory we build in, name of war and ear files.
       app.context.name  Context root for the app
       app.war           Name of the war file
-->

<project name="uwcal.buildear" default="build" basedir=".">

  <target name="build"
          description="Build ear file">
    <property name="app.dest.home"
              location="${org.bedework.temp.ears.home}/${propval.app.ear.name}" />
    <property name="app.dest.ear"
              location="${app.dest.home}/ear" />
    <property name="app.dest.earinf"
              location="${app.dest.ear}/META-INF" />

    <property name="app.ear.file"
              location="${dist.home}/${propval.app.ear.name}.ear" />

    <copy tofile="${app.dest.earinf}/application.xml"
          file="${application.xml}"
          overwrite="yes" >
      <filterset>
        <filter token="DISPLAY-NAME" value="${propval.app.name}"/>
        <filter token="WAR-NAME" value="${propval.app.war.name}"/>
        <filter token="CONTEXT-ROOT" value="${propval.app.context.root}"/>
      </filterset>
    </copy>

    <jar jarfile="${app.ear.file}">
      <fileset dir="${app.dest.ear}" >
        <include name="META-INF/*.xml" />
      </fileset>
      <fileset dir="${dist.home}">
        <include name="${propval.app.war.name}.war" />
      </fileset>
    </jar>

  </target>
</project>
