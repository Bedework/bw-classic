<?xml version="1.0"?>

<!-- ===================================================================
     Unpack the war file built by the last build and copy it into a
     location suitable for the RPI jboss packaging process.

     This file needs to be copied into, and executed from, the quickstart
     build environment.
     =================================================================== -->

<project name="rpi-uwcal" default="copyfiles">

  <import file="bldfiles/globalDefs.xml"/>
  <property file="${user.home}/rpi.build.properties" />
  <property file="${user.home}/uwcal.build.properties" />

  <target name="init" depends="globalDefs">
  </target>

  <target name="copyfiles" depends="init" >
    <echo message="==========================================================" />
    <echo message="Use properties from ${org.bedework.clone.default}" />
    <echo message="==========================================================" />
    <property name="clone.properties"
              location="${org.bedework.config.base}/configs/${org.bedework.clone.default}.properties" />
    <loadproperties srcFile="${clone.properties}" >
      <filterchain>
        <expandproperties/>
      </filterchain>
    </loadproperties>

    <property name="javalib.dest"
              location="${rpi.javalib.dir}/uwcal" />
    <mkdir dir="${javalib.dest}" />

    <property name="jars.dest"
              location="${javalib.dest}/jars" />
    <delete dir="${jars.dest}" />
    <mkdir dir="${jars.dest}" />

    <!-- Copy generated jar files into our library -->
    <copy todir="${jars.dest}" >
      <fileset dir="${org.bedework.temp.jars}" >
        <exclude name="icalendar*.jar" />
        <exclude name="cap*.jar" />
        <exclude name="uwical*.jar" />
      </fileset>
    </copy>

    <!-- In addition copy calendar specific library jar files into our library -->
    <copy todir="${jars.dest}" >
      <fileset dir="${org.bedework.default.lib}" >
        <include name="${ical4j.jar.name}" />
      </fileset>
    </copy>

    <property name="clones.dest"
              location="${javalib.dest}/clones" />
    <mkdir dir="${clones.dest}" />

    <copy file="${clone.properties}" todir="${clones.dest}" overwrite="yes" />

    <echo message="----------------------------------------------------------" />
    <echo message="Unpacking war ${org.bedework.webadmin.war.name}.war" />
    <echo message="----------------------------------------------------------" />

    <property name="admin.dest"
              location="${javalib.dest}/${org.bedework.webadmin.war.name}" />
    <delete dir="${admin.dest}" />
    <mkdir dir="${admin.dest}" />

    <unwar src="${dist.home}/${org.bedework.webadmin.war.name}.war"
           dest="${admin.dest}/war" />

    <echo message="----------------------------------------------------------" />
    <echo message="Unpacking war ${org.bedework.webpubevents.war.name}.war" />
    <echo message="----------------------------------------------------------" />

    <property name="pubevents.dest"
              location="${javalib.dest}/${org.bedework.webpubevents.war.name}" />
    <delete dir="${pubevents.dest}" />
    <mkdir dir="${pubevents.dest}" />

    <unwar src="${dist.home}/${org.bedework.webpubevents.war.name}.war"
           dest="${pubevents.dest}/war" />

    <echo message="----------------------------------------------------------" />
    <echo message="Unpacking war ${org.bedework.webpersonal.war.name}.war" />
    <echo message="----------------------------------------------------------" />

    <property name="personal.dest"
              location="${javalib.dest}/${org.bedework.webpersonal.war.name}" />
    <delete dir="${personal.dest}" />
    <mkdir dir="${personal.dest}" />

    <unwar src="${dist.home}/${org.bedework.webpersonal.war.name}.war"
           dest="${personal.dest}/war" />

    <echo message="----------------------------------------------------------" />
    <echo message="Unpacking war ${org.bedework.caldav.public.war.name}.war" />
    <echo message="----------------------------------------------------------" />

    <property name="pubcaldav.dest"
              location="${javalib.dest}/${org.bedework.caldav.public.war.name}" />
    <delete dir="${pubcaldav.dest}" />
    <mkdir dir="${pubcaldav.dest}" />

    <unwar src="${dist.home}/${org.bedework.caldav.public.war.name}.war"
           dest="${pubcaldav.dest}/war" />

    <echo message="----------------------------------------------------------" />
    <echo message="Unpacking war ${org.bedework.caldav.user.war.name}.war" />
    <echo message="----------------------------------------------------------" />

    <property name="usercaldav.dest"
              location="${javalib.dest}/${org.bedework.caldav.user.war.name}" />
    <delete dir="${usercaldav.dest}" />
    <mkdir dir="${usercaldav.dest}" />

    <unwar src="${dist.home}/${org.bedework.caldav.user.war.name}.war"
           dest="${usercaldav.dest}/war" />
  </target>
</project>

