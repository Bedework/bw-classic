<?xml version="1.0"?>

<!-- Run the bedework indexer service for the bedework Calendar quickstart.

     This is imported by the quickstart build.xml ensuring all changes to this file
     appear in the repository.

     For the moment run this out of the dist directory

     Authors: Mike Douglass   douglm - rpi.edu
-->

<project name="quickstart-run-indexer" default="start-indexer" basedir=".">
  <!-- This target normally overriden by the importing build.xml -->
  <target name="run.init">
    <property name="org.bedework.project.bedework"
              location="${basedir}/bedework" />
  </target>

  <target name="indexer.init" depends="run.init">
    <property name="org.bedework.indexer.dir"
              location="${org.bedework.project.bedework}/dist/temp/shellscr/indexer" />

    <path id="run.classpath">
      <fileset dir="${org.bedework.indexer.dir}/lib">
         <include name="*.jar"/>
      </fileset>
      <pathelement path="${org.bedework.indexer.dir}/classes"/>
      <pathelement location="${org.bedework.indexer.dir}/resources"/>
    </path>

    <pathconvert property="run.txt.classpath"
                 refid="run.classpath"
                 targetos="unix"  pathsep=":" />

    <property name="org.bedework.run.class"
              value="org.bedework.indexer.BwIndexApp" />

    <property name="org.bedework.run.appname"
              value="indexer" />
  </target>

  <!-- =================================================================
       The "start-indexer" target starts the indexer
       ================================================================= -->

  <target name="start-indexer" depends="indexer.init"
          description="starts the indexer">
    <echo message="************************************************************"/>
    <echo message=" * Starting indexer"/>
    <echo message="************************************************************"/>

    <java fork="true" dir="${basedir}"
          classname="${org.bedework.run.class}">
      <classpath refid="run.classpath" />
      <jvmarg value="-Xmx512m" />

      <arg value="-appname"/>
      <arg value="${org.bedework.run.appname}"/>

      <arg value="-listen"/>

      <arg value="-user"/>
      <arg value="admin"/>
    </java>
  </target>
</project>
