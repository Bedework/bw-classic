<?xml version="1.0"?>
<!DOCTYPE project SYSTEM "../WebTest.dtd">

<project name="verifyAdminMainPage" basedir="." default="verifyAdminMainPage">
  <!-- Login to the admin client
    -->
  <macrodef name="adminLogin">
      <attribute name="id" default="douglm"/>
      <attribute name="pw" default="bedework"/>
      <attribute name="url" default="/caladmin/setup.do"/>
    <sequential>
      <invoke description="get Login Page" url="@{url}" />

      <setInputField description="set user name"
                     name="j_username"
                     value="@{id}" />
      <setInputField description="set password"
                     name="j_password"
                     value="@{pw}" />
      <clickButton description="Click the submit button"
                   name="j_security_check" />
    </sequential>
  </macrodef>

  <!-- Verify we are on the main admin menu page and store some urls
    -->
  <macrodef name="verifyAdminMainPage">
    <sequential>
      <!-- Store the links we want to use as mainurlXXX" -->
      <storeElementAttribute description="Extract href of add event url"
                             htmlId="addEventLink"
                             attributeName="href"
                             propertyName="mainurlAddEvent" />
      <storeElementAttribute description="Extract href of add location url"
                             htmlId="addLocationLink"
                             attributeName="href"
                             propertyName="mainurlAddLocation" />
    </sequential>
  </macrodef>

  <!-- Verify we are on the admin edit events page
    -->
  <macrodef name="verifyAdminEditEvents">
    <sequential>
      <!-- We need a unique id so we can use verifyXPath
      <verifyXPath description="simple match1"
                   xpath="/html/body/whatever[@id='editEventsPage']"/>
                   -->
      <verifyText description="Ensure we are on edit events page"
                  text="Edit Events" />
    </sequential>
  </macrodef>

  <!-- Verify we are on the add event page and that we just caused an error
    -->
  <macrodef name="verifyAdminAddEventError">
    <sequential>
      <verifyXPath description="verify add event error"
                   xpath="/html/body/div[@id='header']/div[@id='errors']"/>
    </sequential>
  </macrodef>

  <!-- A property used to allow us to identify an event. -->
  <storeProperty name="eventNumber" value="1" />

  <!-- Define an event title based on the event number
    -->
  <macrodef name="newEventTitle">
    <sequential>
      <!-- Ensure this name can be a string literal in a regex -->
      <storeProperty value="WWWWWebtestCreatedEventNumber#{eventNumber}"
                     property="eventTitle" />
      <storeProperty name="eventNumber" value="#{eventNumber} + 1" eval="true" />
    </sequential>
  </macrodef>

  <!-- Find the url to the event listed on the admin edit event page with the given title.
    -->
  <macrodef name="findEditEvent">
        <attribute name="title" default="X"/>
    <sequential>
      <storeRegEx description="Extract target location from url identified by title"
                  text=".*href=&quot;(.*)&quot;&gt;(@{title})&lt;/a&gt;"
                  group="1"
                  property="editEventUrl" />
    </sequential>
  </macrodef>

  <!-- A property used to allow us to identify a location. -->
  <storeProperty name="locNumber" value="1" />

  <!-- Define a location address based on the location number
    -->
  <macrodef name="newLocAddress">
    <sequential>
      <!-- Ensure this address can be a string literal in a regex -->
      <storeProperty value="WWWWWebtestCreatedLocationNumber#{locNumber}"
                     property="locAddress" />
      <storeProperty name="locNumber" value="#{locNumber} + 1" eval="true" />
    </sequential>
  </macrodef>

</project>

