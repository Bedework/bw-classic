<?xml version="1.0"?>

<!-- ===================== Calendar timer services ====================
     This is the build.xml for the uwcal calendar timer services..

     Authors: Mike Douglass   douglm@rpi.edu
     =================================================================== -->

<project name="cal.timer.services" default="init" >
  <property name="base.name" value="timerServices"/>

  <target name="init">
    <dirname property="this.dir" file="${ant.file}"/>
  </target>

  <target name="build" depends="init"
          description="Build bedework timer service shell script">
    <!-- ==================== Sources and classes ====================== -->

    <fileset id="base.java.sources" dir="${source.home}" >
      <include name="org/bedework/timers/**/*.java"/>
    </fileset>

    <patternset id="base.class.patternset">
      <include name="org/bedework/timers/**/*.class"/>
    </patternset>

    <!-- ==================== Compilation Classpath ==================== -->

    <path id="compile.classpath">
      <pathelement location="${log4j.jar}"/>
      <pathelement location="${org.bedework.calfacadeshared.jar}"/>
      <pathelement location="${org.bedework.calenv.jar}"/>
      <pathelement location="${org.bedework.mail.jar}"/>
      <pathelement location="${org.bedework.calsvci.jar}"/>
      <pathelement location="${org.bedework.appcommon.jar}"/>
      <pathelement location="${org.bedework.calsvc.jar}"/>
      <pathelement location="${org.bedework.ical.jar}"/>
    </path>

    <property name="build.jar.file" location="${org.bedework.timedsvc.jar}" />

    <ant antfile="${buildjar}" inheritRefs="true" target="build" />
  </target>

  <target name="deploy" depends="init"
          description="Deploy bedework timer service shell script">
    <!-- ================= Extra runtime library jars ================== -->

    <fileset id="org.bedework.run.jars" dir="${org.bedework.temp.jars}" >
      <include name="${org.bedework.calsvci.jar.name}" />
      <include name="${org.bedework.mail.jar.name}" />
      <include name="${org.bedework.appcommon.jar.name}" />
    </fileset>

    <fileset id="org.bedework.run.lib.jars" dir="${org.bedework.default.lib}" >
      <include name="${ical4j.jar.name}" />
      <!-- Drag in the commons stuff  -->
      <include name="${struts.lib.dir}/*.jar" />
    </fileset>

    <!-- =================== Core properties defaults ================== -->
    <!-- Values shown here are the default quickstart values.  -->

    <property name="org.bedework.envclass"
              value="edu.washington.cac.calenv.FileJdbcProperties" />
    <property name="org.bedework.jdbcclassname"
              value="org.hsqldb.jdbcDriver" />
    <property name="org.bedework.jdbcurl"
              value="jdbc:hsqldb:hsql://localhost:8887" />
    <property name="org.bedework.jdbcid" value="sa" />
    <property name="org.bedework.jdbcpw" value="" />

    <property name="app.jdbcdriver.jar" value="${appserver.jdbcdriver.jar}" />
    <property name="org.bedework.runsh.log4j.xml"
              location="${org.bedework.timers.base}/timerService/log4j.xml" />

    <!-- ===============================================================
         Build a runnable component and zip it up
         =============================================================== -->

    <property name="app.run.shellscr"
              location="${org.bedework.timers.base}/timerService/timers.sh" />
    <property name="app.run.jar.file" value="${build.jar.file}" />
    <property name="app.run.main.class"
              value="org.bedework.timers.service.DbPollerTimerService" />

    <ant antfile="${buildsh}"
         inheritRefs="true" target="build" />
  </target>
</project>
