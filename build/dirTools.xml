<?xml version="1.0"?>

<!-- ===================================================================
     Load the deployment configuration from the properties file. We also load
     the run time options and define some properties based on some of the
     values found there
     =================================================================== -->
<project name="dirTools" basedir="." default="">

  <!-- =================================================================
       Build and run the directory tools
       ================================================================= -->

  <target name="initDir" depends="init"
          description="Build and run directory init">
    <antfetch antfile="${org.bedework.project.bwtools}/build.xml" inheritall="false"
              target="initDir"
              return="org.bedework.directory.init.status" >
      <propertyset>
        <propertyref prefix="org.bedework.directory."/>
      </propertyset>
      <property name="org.bedework.libcache.dir"
                location="${org.bedework.project.bedework}/libcache"/>
    </antfetch>
  </target>

  <target name="initDirForQuickstart" depends="init.build,build.rpiutil"
          description="Build and run directory tool to initialise a quickstart system">
    <antfetch antfile="${org.bedework.project.bwtools}/build.xml" inheritall="false"
              target="initDirForQuickstart"
              return="org.bedework.directory.init.status" >
      <propertyset>
        <propertyref prefix="org.bedework.directory."/>
      </propertyset>
      <property name="org.bedework.libcache.dir"
                location="${org.bedework.project.bedework}/libcache"/>
    </antfetch>
  </target>

  <target name="addUser" depends="init"
          description="Run directory tools to add a user">
          <!--
    <loadDeployConfig />
 -->
    <property name="app.dest.classes"
              location="${dist.home}/temp/dirTool/classes" />

    <delete dir="${app.dest.classes}" />
    <mkdir dir="${app.dest.classes}" />

    <path id="run.classpath">
      <fileset dir="${org.bedework.project.bedework}/applib">
         <include name="*.jar"/>
      </fileset>
      <pathelement location="${org.bedework.project.bwtools}/resources" />
      <pathelement location="${app.dest.classes}" />
    </path>

    <copy todir="${app.dest.classes}"
          file="${org.bedework.project.bwtools}/resources/log4j.xml" />

    <pathconvert property="run.txt.classpath"
                 refid="run.classpath"
                 targetos="unix"  pathsep=":" />

    <java classname="org.bedework.tools.directory.DirTool"
          fork="true"
          failonerror="false"
          resultproperty="org.bedework.cmdutil.status" >
      <classpath refid="run.classpath" />
      <arg value="-addUser" />
      <arg value="${org.bedework.directory.account}" />
      <arg value="${org.bedework.directory.firstname}" />
      <arg value="${org.bedework.directory.lastname}" />
      <arg value="${org.bedework.directory.password}" />
      <!-- <jvmarg value="-agentlib:yjpagent" /> -->
    </java>
  </target>

  <target name="addGroup" depends="init.build,build.rpiutil"
          description="Build and run directory tools to add a group">
    <ant antfile="${org.bedework.project.bwtools}/build.xml" inheritall="false"
           target="addGroup" >
      <propertyset>
        <propertyref prefix="org.bedework.directory."/>
      </propertyset>
      <property name="org.bedework.libcache.dir"
                location="${org.bedework.project.bedework}/libcache"/>
    </ant>
  </target>

  <target name="addGroupMember" depends="init.build,build.rpiutil"
          description="Build and run directory tools to add a group member">
    <ant antfile="${org.bedework.project.bwtools}/build.xml" inheritall="false"
           target="addGroupMember" >
      <propertyset>
        <propertyref prefix="org.bedework.directory."/>
      </propertyset>
      <property name="org.bedework.libcache.dir"
                location="${org.bedework.project.bedework}/libcache"/>
    </ant>
  </target>
</project>
